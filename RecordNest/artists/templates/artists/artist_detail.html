{% extends "main/base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/artists.css' %}">

<div class="record-container">

  <!-- Cabecera del artista -->
  <div class="artist-header">
    <img src="{{ artist.image_url|default:'/static/images/placeholder-image.png' }}" alt="{{ artist.name }}" class="artist-photo">
    <div class="artist-info">
      <h1>{{ artist.name }}</h1>
      {% if artist.profile %}
        <p>{{ artist.profile|safe}}</p>
      {% else %}
        <p>Información no disponible.</p>
      {% endif %}
    </div>
  </div>

  <!-- Barra de búsqueda -->
  <div class="search-container">
      <form method="get" action="">
          <!-- Los parámetros 'id' y 'mode' se mantienen en la URL -->
          <input type="hidden" name="id" value="{{ artist.id }}">
          <input type="hidden" name="mode" value="{{ mode }}">
          
          <!-- Campo de búsqueda -->
          <input type="text" name="search" id="search-input" placeholder="Buscar discos..." value="{{ search }}">
          
          <button type="submit"><i class="fas fa-search"></i> Buscar</button>
      </form>
  </div>

  <!-- Selector de modo (ocultarlo si hay búsqueda) -->
  {% if not hide_mode_buttons %}
  <div class="mode-toggle">
    <a href="?id={{ artist.id }}&mode=main" class="{% if mode == 'main' %}active{% endif %}">Discografía principal</a>
    <a href="?id={{ artist.id }}&mode=appearances" class="{% if mode == 'appearances' %}active{% endif %}">Apariciones</a>
  </div>
  {% endif %}

  <!-- Título -->
  <h2>{% if search %}Resultados de la búsqueda{% else %}{{ mode|yesno:"Discografía principal,Apariciones" }}{% endif %}</h2>

  <!-- Rejilla de discos -->
  <div class="grid-container" id="release-grid">
    {% for release in releases %}
      <a href="{% if release.type == 'master' %}{% url 'record_detail' %}?master_id={{ release.id }}{% elif release.type == 'release' %}{% url 'record_detail' %}?release_id={{ release.id }}{% endif %}"
        class="card-link release-card"
        data-title="{{ release.title|lower }}"
        data-year="{{ release.year|default:'0' }}">
        <div class="card">
          <div class="image-container">
            <img src="{{ release.cover_image|default:'/static/images/placeholder-image.png' }}" alt="{{ release.title }}">
          </div>
          <div class="card-body">
            <h3 class="card-title">
              {{ release.title|default:'' }}
            </h3>
            <p><strong>Año:</strong> {{ release.year|default:"N/A" }}</p>
          </div>
        </div>
      </a>
    {% empty %}
      <p>No hay discos para mostrar.</p>
    {% endfor %}
  </div>


  <!-- Paginación -->
  {% if total_pages > 1 %}
    <div class="pagination">
      {% if has_previous %}
        <a href="?id={{ artist.id }}&mode={{ mode }}&page={{ previous_page_number }}&search={{ search }}">&laquo; Anterior</a>
      {% endif %}
      <span>Página {{ current_page }} de {{ total_pages }}</span>
      {% if has_next %}
        <a href="?id={{ artist.id }}&mode={{ mode }}&page={{ next_page_number }}&search={{ search }}">Siguiente &raquo;</a>
      {% endif %}
    </div>
  {% endif %}

</div>

<script>
  const searchInput = document.getElementById("search-input");
  const cards = document.querySelectorAll(".release-card");
</script>

{% endblock %}
